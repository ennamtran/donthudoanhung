{\rtf1\ansi\ansicpg1252\cocoartf2867
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;\red0\green0\blue255;\red255\green255\blue254;
\red14\green110\blue109;\red144\green1\blue18;\red19\green118\blue70;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;\cssrgb\c0\c0\c100000;\cssrgb\c100000\c100000\c99608;
\cssrgb\c0\c50196\c50196;\cssrgb\c63922\c8235\c8235;\cssrgb\c3529\c52549\c34510;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf0 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 \
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 import\cf0 \strokec2  \{ \cf5 \strokec5 GoogleGenAI\cf0 \strokec2 , \cf5 \strokec5 Type\cf0 \strokec2  \} \cf3 \strokec3 from\cf0 \strokec2  \cf6 \strokec6 "@google/genai"\cf0 \strokec2 ;\cb1 \
\
\cf3 \cb4 \strokec3 export\cf0 \strokec2  \cf3 \strokec3 async\cf0 \strokec2  \cf3 \strokec3 function\cf0 \strokec2  analyzePetitionContent(content: \cf3 \strokec3 string\cf0 \strokec2 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf0 \cb4   \cf3 \strokec3 try\cf0 \strokec2  \{\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  ai = \cf3 \strokec3 new\cf0 \strokec2  \cf5 \strokec5 GoogleGenAI\cf0 \strokec2 (\{ apiKey: process.env.\cf5 \strokec5 API_KEY\cf0 \strokec2  \});\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  response = \cf3 \strokec3 await\cf0 \strokec2  ai.models.generateContent(\{\cb1 \
\cb4       model: \cf6 \strokec6 "gemini-3-flash-preview"\cf0 \strokec2 ,\cb1 \
\cb4       contents: \cf6 \strokec6 `Ph\'e2n t\'edch v\'e0 t\'f3m t\uc0\u7855 t n\u7897 i dung \u273 \u417 n th\u432 : "\cf0 \strokec2 $\{content\}\cf6 \strokec6 "`\cf0 \strokec2 ,\cb1 \
\cb4       config: \{\cb1 \
\cb4         systemInstruction: \cf6 \strokec6 "B\uc0\u7841 n l\'e0 chuy\'ean vi\'ean ti\u7871 p d\'e2n UBND x\'e3. T\'f3m t\u7855 t v\u7909  vi\u7879 c d\u432 \u7899 i 30 t\u7915  v\'e0 ph\'e2n lo\u7841 i v\'e0o: 'Khi\u7871 u n\u7841 i', 'T\u7889  c\'e1o', ho\u7863 c 'Ki\u7871 n ngh\u7883 , ph\u7843 n \'e1nh'."\cf0 \strokec2 ,\cb1 \
\cb4         responseMimeType: \cf6 \strokec6 "application/json"\cf0 \strokec2 ,\cb1 \
\cb4         responseSchema: \{\cb1 \
\cb4           \cf3 \strokec3 type\cf0 \strokec2 : \cf5 \strokec5 Type\cf0 \strokec2 .\cf5 \strokec5 OBJECT\cf0 \strokec2 ,\cb1 \
\cb4           properties: \{\cb1 \
\cb4             \cf3 \strokec3 type\cf0 \strokec2 : \{ \cf3 \strokec3 type\cf0 \strokec2 : \cf5 \strokec5 Type\cf0 \strokec2 .\cf5 \strokec5 STRING\cf0 \strokec2  \},\cb1 \
\cb4             summary: \{ \cf3 \strokec3 type\cf0 \strokec2 : \cf5 \strokec5 Type\cf0 \strokec2 .\cf5 \strokec5 STRING\cf0 \strokec2  \},\cb1 \
\cb4             urgency: \{ \cf3 \strokec3 type\cf0 \strokec2 : \cf5 \strokec5 Type\cf0 \strokec2 .\cf5 \strokec5 STRING\cf0 \strokec2  \}\cb1 \
\cb4           \},\cb1 \
\cb4           required: [\cf6 \strokec6 "type"\cf0 \strokec2 , \cf6 \strokec6 "summary"\cf0 \strokec2 , \cf6 \strokec6 "urgency"\cf0 \strokec2 ],\cb1 \
\cb4         \},\cb1 \
\cb4       \},\cb1 \
\cb4     \});\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  \cf5 \strokec5 JSON\cf0 \strokec2 .parse(response.text || \cf6 \strokec6 '\{\}'\cf0 \strokec2 );\cb1 \
\cb4   \} \cf3 \strokec3 catch\cf0 \strokec2  (error) \{\cb1 \
\cb4     console.error(\cf6 \strokec6 "AI Analysis error:"\cf0 \strokec2 , error);\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  \cf3 \strokec3 null\cf0 \strokec2 ;\cb1 \
\cb4   \}\cb1 \
\cb4 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 export\cf0 \strokec2  \cf3 \strokec3 async\cf0 \strokec2  \cf3 \strokec3 function\cf0 \strokec2  searchLegalGrounds(content: \cf3 \strokec3 string\cf0 \strokec2 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf0 \cb4   \cf3 \strokec3 try\cf0 \strokec2  \{\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  ai = \cf3 \strokec3 new\cf0 \strokec2  \cf5 \strokec5 GoogleGenAI\cf0 \strokec2 (\{ apiKey: process.env.\cf5 \strokec5 API_KEY\cf0 \strokec2  \});\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  response = \cf3 \strokec3 await\cf0 \strokec2  ai.models.generateContent(\{\cb1 \
\cb4       model: \cf6 \strokec6 "gemini-3-pro-preview"\cf0 \strokec2 ,\cb1 \
\cb4       contents: \cf6 \strokec6 `T\'ecm c\uc0\u259 n c\u7913  ph\'e1p lu\u7853 t Vi\u7879 t Nam cho v\u7909  vi\u7879 c: "\cf0 \strokec2 $\{content\}\cf6 \strokec6 "`\cf0 \strokec2 ,\cb1 \
\cb4       config: \{\cb1 \
\cb4         systemInstruction: \cf6 \strokec6 "B\uc0\u7841 n l\'e0 chuy\'ean gia ph\'e1p lu\u7853 t h\'e0nh ch\'ednh. Li\u7879 t k\'ea c\'e1c b\u7897  lu\u7853 t li\'ean quan."\cf0 \strokec2 ,\cb1 \
\cb4         tools: [\{ googleSearch: \{\} \}],\cb1 \
\cb4       \},\cb1 \
\cb4     \});\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  chunks = response.candidates?.[\cf7 \strokec7 0\cf0 \strokec2 ]?.groundingMetadata?.groundingChunks || [];\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  \{\cb1 \
\cb4       text: response.text,\cb1 \
\cb4       links: chunks.map((c: \cf3 \strokec3 any\cf0 \strokec2 ) => (\{ title: c.web?.title || \cf6 \strokec6 "V\uc0\u259 n b\u7843 n lu\u7853 t"\cf0 \strokec2 , uri: c.web?.uri || \cf6 \strokec6 "#"\cf0 \strokec2  \})).filter((l: \cf3 \strokec3 any\cf0 \strokec2 ) => l.uri !== \cf6 \strokec6 "#"\cf0 \strokec2 )\cb1 \
\cb4     \};\cb1 \
\cb4   \} \cf3 \strokec3 catch\cf0 \strokec2  (error) \{\cb1 \
\cb4     console.error(\cf6 \strokec6 "Legal Search error:"\cf0 \strokec2 , error);\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  \cf3 \strokec3 null\cf0 \strokec2 ;\cb1 \
\cb4   \}\cb1 \
\cb4 \}\cb1 \
\
\pard\pardeftab720\partightenfactor0
\cf3 \cb4 \strokec3 export\cf0 \strokec2  \cf3 \strokec3 async\cf0 \strokec2  \cf3 \strokec3 function\cf0 \strokec2  generateDraftResponse(petition: \cf3 \strokec3 any\cf0 \strokec2 ) \{\cb1 \
\pard\pardeftab720\partightenfactor0
\cf0 \cb4   \cf3 \strokec3 try\cf0 \strokec2  \{\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  ai = \cf3 \strokec3 new\cf0 \strokec2  \cf5 \strokec5 GoogleGenAI\cf0 \strokec2 (\{ apiKey: process.env.\cf5 \strokec5 API_KEY\cf0 \strokec2  \});\cb1 \
\cb4     \cf3 \strokec3 const\cf0 \strokec2  response = \cf3 \strokec3 await\cf0 \strokec2  ai.models.generateContent(\{\cb1 \
\cb4       model: \cf6 \strokec6 "gemini-3-pro-preview"\cf0 \strokec2 ,\cb1 \
\cb4       contents: \cf6 \strokec6 `So\uc0\u7841 n d\u7921  th\u7843 o c\'f4ng v\u259 n tr\u7843  l\u7901 i cho \u273 \u417 n th\u432  m\'e3 \cf0 \strokec2 $\{petition.id\}\cf6 \strokec6  g\uc0\u7917 i \'f4ng/b\'e0 \cf0 \strokec2 $\{petition.petitioner.name\}\cf6 \strokec6 . N\uc0\u7897 i dung: \cf0 \strokec2 $\{petition.content\}\cf6 \strokec6 `\cf0 \strokec2 ,\cb1 \
\cb4       config: \{\cb1 \
\cb4         systemInstruction: \cf6 \strokec6 "B\uc0\u7841 n l\'e0 Ch\'e1nh V\u259 n ph\'f2ng UBND x\'e3. So\u7841 n th\u7843 o v\u259 n b\u7843 n h\'e0nh ch\'ednh chu\u7849 n m\u7921 c, trang tr\u7885 ng."\cf0 \strokec2 ,\cb1 \
\cb4         temperature: \cf7 \strokec7 0.7\cf0 \strokec2 ,\cb1 \
\cb4       \}\cb1 \
\cb4     \});\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  response.text;\cb1 \
\cb4   \} \cf3 \strokec3 catch\cf0 \strokec2  (error) \{\cb1 \
\cb4     console.error(\cf6 \strokec6 "Draft generation error:"\cf0 \strokec2 , error);\cb1 \
\cb4     \cf3 \strokec3 return\cf0 \strokec2  \cf3 \strokec3 null\cf0 \strokec2 ;\cb1 \
\cb4   \}\cb1 \
\cb4 \}\cb1 \
}